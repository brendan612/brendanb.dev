---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { site } from '../consts/site';

const projects = (await getCollection('projects')).sort(
	(a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);
---

<BaseLayout title={`${site.name} | Projects`} description="Portfolio projects and experiments by Brendan Bishop.">
	<section class="container section">
		<h1 class="section-title animate-fade-up animate-delay-1">Projects</h1>
		<p class="muted intro animate-fade-up animate-delay-2">
			A mix of production work, experiments, and archived concepts that shaped
			how I build today.
		</p>

		<div class="grid">
			{
				projects.map((entry, i) => (
					<article
						class={`project-card animate-fade-up`}
						style={`animation-delay: ${250 + i * 100}ms`}
					>
						{/* Window bar */}
						<div class="card-bar">
							<div class="card-dots">
								<span class="dot" />
								<span class="dot" />
								<span class="dot" />
							</div>
							<span class="card-filename mono">
								{entry.data.title.toLowerCase().replace(/\s+/g, '-')}.md
							</span>
						</div>

						<div class="card-body">
							<div class="meta">
								<span class="chip">{entry.data.tags[0] ?? 'Project'}</span>
								<span class="status-badge" data-status={entry.data.status}>
									{entry.data.status.replace('-', ' ')}
								</span>
							</div>
							<h2>
								<a href={`/projects/${entry.slug}/`}>{entry.data.title}</a>
							</h2>
							<p class="summary">{entry.data.summary}</p>
							<p class="muted date mono">
								{entry.data.date.toLocaleDateString('en-US', {
									year: 'numeric',
									month: 'short',
									day: 'numeric',
								})}
							</p>
						</div>
					</article>
				))
			}
		</div>
	</section>
</BaseLayout>

<style>
	.section {
		padding-top: var(--space-16);
	}

	.intro {
		max-width: 55ch;
		margin-bottom: var(--space-2);
	}

	.grid {
		margin-top: var(--space-6);
		display: grid;
		grid-template-columns: repeat(12, minmax(0, 1fr));
		gap: 1rem;
	}

	/* ── Project Card ── */
	.project-card {
		grid-column: span 6;
		border: 1px solid var(--line);
		border-radius: var(--radius-md);
		background: color-mix(in oklab, var(--surface) 95%, white 5%);
		box-shadow: var(--shadow);
		overflow: hidden;
		transition:
			transform 280ms var(--ease-out-expo),
			box-shadow 280ms var(--ease-out-expo),
			border-color 280ms var(--ease-out-expo);
	}

	.project-card:hover {
		transform: translateY(-4px);
		box-shadow: var(--shadow), var(--glow);
		border-color: color-mix(in oklab, var(--accent) 30%, var(--line));
	}

	/* Window bar */
	.card-bar {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem 0.85rem;
		background: color-mix(in oklab, var(--surface) 70%, black 30%);
		border-bottom: 1px solid var(--line);
	}

	.card-dots {
		display: flex;
		gap: 0.35rem;
	}

	.dot {
		width: 0.42rem;
		height: 0.42rem;
		border-radius: 50%;
		background: var(--line);
		transition: background 200ms ease;
	}

	.project-card:hover .dot:nth-child(1) { background: #e35; }
	.project-card:hover .dot:nth-child(2) { background: #ea0; }
	.project-card:hover .dot:nth-child(3) { background: #2d4; }

	.card-filename {
		font-size: 0.7rem;
		color: var(--muted);
		opacity: 0.7;
	}

	/* Card body */
	.card-body {
		padding: 1.1rem 1.2rem 1.3rem;
	}

	.meta {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 0.8rem;
		margin-bottom: 0.3rem;
	}

	.status-badge {
		display: inline-flex;
		align-items: center;
		gap: 0.3rem;
		font-family: var(--font-mono);
		font-size: 0.7rem;
		text-transform: capitalize;
		color: var(--muted);
	}

	.status-badge::before {
		content: '';
		width: 0.35rem;
		height: 0.35rem;
		border-radius: 50%;
		background: var(--muted);
	}

	.status-badge[data-status="live"]::before {
		background: #2d4;
		box-shadow: 0 0 4px rgba(34, 221, 68, 0.4);
	}

	.status-badge[data-status="in-progress"]::before {
		background: var(--accent);
		box-shadow: 0 0 4px rgba(221, 122, 45, 0.4);
	}

	.project-card h2 {
		font-family: var(--font-display);
		font-size: 1.4rem;
		font-weight: 600;
		font-style: italic;
		line-height: 1.15;
		margin: 0.3rem 0 0.35rem;
		letter-spacing: -0.01em;
	}

	.project-card h2 a {
		transition: color var(--transition-fast);
	}

	.project-card h2 a:hover,
	.project-card h2 a:focus-visible {
		color: var(--accent-strong);
	}

	.summary {
		color: var(--muted);
		font-size: 0.9rem;
		line-height: 1.5;
	}

	.date {
		margin-top: 0.6rem;
		margin-bottom: 0;
		font-size: 0.75rem;
	}

	@media (max-width: 860px) {
		.project-card {
			grid-column: span 12;
		}
	}
</style>
