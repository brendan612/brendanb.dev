---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { site } from '../../consts/site';

export async function getStaticPaths() {
	const projects = await getCollection('projects');
	return projects.map((project) => ({ params: { slug: project.slug }, props: { project } }));
}

const { project } = Astro.props;
const { Content } = await render(project);
---

<BaseLayout title={`${project.data.title} | ${site.name}`}>
	<article class="container article">
		<!-- Back link -->
		<p class="back-row animate-fade-up animate-delay-1">
			<a class="back" href="/projects">
				<span class="back-arrow" aria-hidden="true">&#8592;</span>
				<span class="mono">Back to projects</span>
			</a>
		</p>

		<!-- Header -->
		<header class="article-header animate-fade-up animate-delay-2">
			<div class="tag-row">
				{project.data.tags.map((tag: string) => (
					<span class="chip">{tag}</span>
				))}
				<span class="status-badge mono" data-status={project.data.status}>
					{project.data.status.replace('-', ' ')}
				</span>
			</div>
			<h1>{project.data.title}</h1>
			<p class="muted summary">{project.data.summary}</p>
		</header>

		<!-- Links -->
		{(project.data.liveUrl || project.data.repoUrl) && (
			<div class="links animate-fade-up animate-delay-3">
				{project.data.liveUrl && (
					<a href={project.data.liveUrl} target="_blank" rel="noreferrer" class="action-link">
						<span class="mono">View Live</span>
						<span aria-hidden="true">&#8599;</span>
					</a>
				)}
				{project.data.repoUrl && (
					<a href={project.data.repoUrl} target="_blank" rel="noreferrer" class="action-link">
						<span class="mono">View Code</span>
						<span aria-hidden="true">&#8599;</span>
					</a>
				)}
			</div>
		)}

		<!-- Content -->
		<div class="content animate-fade-up animate-delay-4">
			<Content />
		</div>
	</article>
</BaseLayout>

<style>
	.article {
		padding-top: var(--space-12);
		max-width: 52rem;
	}

	/* ── Back ── */
	.back-row {
		margin-bottom: var(--space-6);
	}

	.back {
		display: inline-flex;
		align-items: center;
		gap: 0.4rem;
		font-size: 0.84rem;
		color: var(--muted);
		transition: color var(--transition-fast);
	}

	.back:hover,
	.back:focus-visible {
		color: var(--accent-strong);
	}

	.back-arrow {
		transition: transform var(--transition-fast);
	}

	.back:hover .back-arrow {
		transform: translateX(-3px);
	}

	/* ── Header ── */
	.article-header {
		margin-bottom: var(--space-2);
	}

	.tag-row {
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		gap: 0.4rem;
		margin-bottom: var(--space-3);
	}

	.status-badge {
		display: inline-flex;
		align-items: center;
		gap: 0.3rem;
		font-size: 0.72rem;
		text-transform: capitalize;
		color: var(--muted);
	}

	.status-badge::before {
		content: '';
		width: 0.35rem;
		height: 0.35rem;
		border-radius: 50%;
		background: var(--muted);
	}

	.status-badge[data-status="live"]::before {
		background: #2d4;
		box-shadow: 0 0 4px rgba(34, 221, 68, 0.4);
	}

	.status-badge[data-status="in-progress"]::before {
		background: var(--accent);
		box-shadow: 0 0 4px rgba(221, 122, 45, 0.4);
	}

	h1 {
		font-family: var(--font-display);
		font-size: clamp(1.8rem, 1.4rem + 1.8vw, 3.2rem);
		font-weight: 700;
		font-style: italic;
		line-height: 1.05;
		letter-spacing: -0.02em;
		margin: 0 0 var(--space-2);
	}

	.summary {
		font-size: 1.05rem;
		line-height: 1.55;
		max-width: 55ch;
	}

	/* ── Links ── */
	.links {
		display: flex;
		gap: 0.75rem;
		margin: var(--space-6) 0;
	}

	.action-link {
		display: inline-flex;
		align-items: center;
		gap: 0.3rem;
		padding: 0.35rem 0.8rem;
		border: 1px solid var(--line);
		border-radius: var(--radius-sm);
		font-size: 0.82rem;
		color: var(--ink);
		background: color-mix(in oklab, var(--surface) 60%, transparent);
		transition: border-color var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
	}

	.action-link:hover,
	.action-link:focus-visible {
		color: var(--accent-strong);
		border-color: color-mix(in oklab, var(--accent) 40%, var(--line));
		transform: translateY(-1px);
	}

	/* ── Content ── */
	.content {
		padding-top: var(--space-4);
		border-top: 1px dashed var(--line);
	}

	.content :global(p),
	.content :global(li) {
		color: var(--ink);
		line-height: 1.7;
	}

	.content :global(p + p) {
		margin-top: var(--space-4);
	}

	.content :global(h2),
	.content :global(h3) {
		font-family: var(--font-display);
		font-style: italic;
		margin-top: var(--space-8);
		margin-bottom: var(--space-3);
	}

	.content :global(code) {
		font-family: var(--font-mono);
		font-size: 0.88em;
		padding: 0.15em 0.4em;
		background: var(--tag-bg);
		border-radius: var(--radius-sm);
		color: var(--tag-fg);
	}

	.content :global(a) {
		color: var(--accent-strong);
		text-decoration: underline;
		text-decoration-color: color-mix(in oklab, var(--accent) 40%, transparent);
		text-underline-offset: 0.15em;
		transition: text-decoration-color var(--transition-fast);
	}

	.content :global(a:hover) {
		text-decoration-color: var(--accent);
	}
</style>
